{% extends 'base.html' %}
{% load static %}

{% block content %}
<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div>
     {% for pi in player_info %}
     <div>
        <h3> <b>{{ pi.full_name | upper }}</b></h3>
     </div>
     <div>
     <a href="{% url 'nba_data_app:get_one_season_playergamelog' id=pi.id season=year %}">Current Season log</a>
    </div>
    <div>
        <a href="{% url 'nba_data_app:get_all_seasons_playergamelog' id=pi.id %}">All Seasons log</a>
    </div>
    <div>
        <a href="{% url 'nba_data_app:player_dashboard' id=pi.id %}">Player Dashboard</a>
    </div>
    <div>
        <a href="{% url 'nba_data_app:pre_season_stats' id=pi.id %}">Pre Season Stats</a>
    </div>
    <div>
        <a href="{% url 'nba_data_app:regular_season_stats' id=pi.id %}">Regular Season Stats</a>
    </div>
    <div>
        <a href="{% url 'nba_data_app:post_season_stats' id=pi.id %}">Post Season Stats</a>
    </div>
    <div>
        <a href="{% url 'nba_data_app:rankings_regular_season' id=pi.id %}">Rankings Regular Season</a>
    </div>
    <div>
        <a href="{% url 'nba_data_app:rankings_post_season' id=pi.id %}">Rankings Post Season</a>
    </div>
    {% endfor %}
   
    
    </div>
    <br>

    <div>
     <h3>NEXT GAME</h3>
     <table class="table">
        <thead class="thead-dark">
        <tr>
            <th scope="col">GAME_DATE</th>
            <th scope="col">GAME_TIME</th>
            <th scope="col">HOME / AWAY</th>
            <th scope="col">VS_TEAM</th>
        </tr>
        </thead>
        <tbody>
        {% for ng in next_game %}
        <tr>
            <td data-title="GAME_DATE">{{ ng.GAME_DATE }}</td>
            <td data-title="GAME_TIME">{{ ng.GAME_TIME }}</td>
            <td data-title="HOME / AWAY">{{ ng.LOCATION }}</td>
            <td data-title="VS_TEAM">{{ ng.VS_TEAM_ABBREVIATION }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>

    <br>

    <!-- <div>
        <br>
        <h3>LAST TEN GAMES</h3>
        <table class="table">
            <thead class="thead-dark">
            <tr>
                <th scope="col">GAME_DATE</th>
                <th scope="col">GAME_ID</th>
                <th scope="col">MatchUp</th>
                <th scope="col">WL</th>
                <th scope="col">MIN</th>
                <th scope="col">FGPCT</th>
                <th scope="col">FG3PCT</th>
                <th scope="col">REB</th>
                <th scope="col">AST</th>
                <th scope="col">STL</th>
                <th scope="col">BLK</th>
                <th scope="col">TOV</th>
                <th scope="col">PTS</th>
            </tr>
            </thead>
            <tbody>
            {% for pg in player_games  %}
            <tr>
                <td data-title="GAME_DATE">{{ pg.GAME_DATE }}</td>
                <td data-title="GAME_ID"><a href="{% url 'nba_data_app:box_score_data' id=pg.GAME_ID %}" >{{ pg.GAME_ID }}</a></td>
                <td data-title="MatchUp">{{ pg.MATCHUP  }}</td>
                <td data-title="WL">{{ pg.WL }}</td>
                <td data-title="MIN">{{ pg.MIN }}</td>
                <td data-title="FG_PCT">{{ pg.FG_PCT }}</td>
                <td data-title="FG3_PCT">{{ pg.FG3_PCT}}</td>
                <td data-title="REB">{{ pg.REB }}</td>
                <td data-title="AST">{{ pg.AST }}</td>
                <td data-title="STL">{{ pg.STL }}</td>
                <td data-title="BLK">{{ pg.BLK }}</td>
                <td data-title="TOV">{{ pg.TOV }}</td>
                <td data-title="PTS">{{ pg.PTS }}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        </div> -->

    <!-- <div>
       <h3>CAREER HIGHS</h3>
       <table class="table">
           <thead class="thead-dark">
           <tr>
               <th scope="col">GAME_DATE</th>
               <th scope="col">VS_TEAM_ID</th>
               <th scope="col">VS_TEAM_ABBR</th>
               <th scope="col">STAT</th>
               <th scope="col">STATS_VALUE</th>
               <th scope="col">STAT_ORDER</th>
               <th scope="col">DATE_EST</th>
           </tr>
           </thead>
           <tbody>
           {% for c in career_highs %}
           <tr>
               <td>{{ c.GAME_DATE}}</td>
               <td>{{ c.VS_TEAM_ID }}</td>
               <td>{{ c.VS_TEAM_ABBREVIATION }}</td>
               <td>{{ c.STAT }}</td>
               <td>{{ c.STATS_VALUE }}</td>
               <td>{{ c.STAT_ORDER }}</td>
               <td>{{ c.DATE_EST }}</td>
           </tr>
           {% endfor %}
           </tbody>
       </table>

    </div>

    <br>

    <div>
        {{ season_highs }}
    </div>
    <br> -->
    <div>
        <svg id="svgID" width="640" height="480"></svg>
    </div>
</body>
    <script>
    
        // var last_10_player_games = 
        // console.log(received_data);

        // for (let value of Object.values(received_data)) {
        //     // console.log(value.SEASON_ID)
        //     // console.log(value.TEAM_ID)
        //     // console.log(value.TEAM_ABBREVIATION)
        //     // console.log(value.TEAM_NAME)
        //     // console.log(value.GAME_ID)
        //     // console.log(value.GAME_DATE)
        //     // console.log(value.MATCHUP)
        //     // console.log(value.WL)
        //     // console.log(value.MIN)
        //     console.log(value.PTS)
        // }
        

     
        // var margin  = {top: 20, right: 20, bottom: 100, left: 60},
        //                width   = 600 - margin.left - margin.right,
        //                height  = 400 - margin.top - margin.bottom,
        //                x       = d3.scale.ordinal().rangeRoundBands([0,width], 0.5),
        //                y       = d3.scale.linear().range([height,0]);

        // var svg = d3.select("svg")
        //             .attr("width", width + margin.left + margin.right)
        //             .attr("height", height + margin.top + margin.bottom)
        //             .append("g")
        //             .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        // d3.json({{ received_data }}, function (data)
        //         {
        //             x.domain(data.map(function (d)
        //             {
        //                 return d.name;
        //             }));

        //             y.domain([0, d3.max(data, function (d)
        //             {
        //                 return d.wc;
        //             })]);

        //             svg.append("g")
        //                 .attr("class", "x axis")
        //                 .attr("transform", "translate(0, " + height + ")")
        //                 .call(xAxis)
        //                 .selectAll("text")
        //                 .style("text-anchor", "middle")
        //                 .attr("dx", "-0.5em")
        //                 .attr("dy", "-.55em")
        //                 .attr("y", 30)
        //                 .attr("transform", "rotate(0)" );
                    
        //             svg.append("g")
        //                 .attr("class", "y axis")
        //                 .call(yAxis)
        //                 .append("text")
        //                 .attr("transform", "rotate(-90)")
        //                 .attr("y", 5)
        //                 .attr("dy", "0.8em")
        //                 .attr("text-anchor", "end")
        //                 .text("Word Count");

        //             svg.selectAll("bar")
        //                 .data(data)
        //                 .enter()
        //                 .append("rect")
        //                 .style("fill", "orange")
        //                 .attr("x", function(d)
        //                 {
        //                     return x(d.name);
        //                 })
        //                 .attr("width", x.rangeBand())
        //                 .attr("y", function (d)
        //                 {
        //                     return y(d.wc);
        //                 })
        //                 .attr("height", function (d)
        //                 {
        //                     return height - y(d.wc);
        //                 })
        //         })
        
    var svg = d3.select("svg"),
                margin = 200,
                width = svg.attr("width") - margin,
                height = svg.attr("height") - margin;
    
    svg.append("text")
       .attr("transform", "translate(100,0)")
       .attr("x", 50)
       .attr("y", 50)
       .attr("font-size", "24px")
       .text("Last 10 games played")

    var xScale = d3.scaleBand()
                   .range([0, width])
                   .padding(0.4),
        yScale = d3.scaleLinear().range([height, 0]);

    var g = svg.append("g")
            .attr("transform", "translate(" + 100 + "," + 100 + ")");
    // d3.json({{ last_10_player_games }}, function(data) {
    //     console.log(data)
    // });

    // d3.json({{ json_player_games | safe }})
    //   .then(function(data) {
    //     xScale.domain(data.map(function(d){
    //             return d.GAME_DATE
                
    //     }))
    
    // });

    d3.csv("{% static 'csvs/last_10_player_games.csv' %}")
      .then(function(data) {
            console.log(data)
            xScale.domain(data.map(function(d){
                return d.GAME_DATE
                
            }))

            
            yScale.domain([0, d3.max(data, function(d) {
                // console.log(typeof(parseInt(d.PTS)))
                return d.PTS;
            })])

            g.append("g")
             .attr("transform", "translate(0,"+height+")")
             .call(d3.axisBottom(xScale))
             .selectAll("text")
             .style("text-anchor", "end")
             .attr("dx", "-.8em")
             .attr("dy", ".15em")
             .attr("stroke", "black")
             .attr("transform", "rotate(-50)")
            
            g.append("g")
             .call(d3.axisLeft(yScale).ticks(10))
             .append("text")
             .attr("transform", "rotate(-90)")
             .attr("y", 10)
             .attr("dy", "-5em")
             .attr("text-anchor", "end")
             .attr("stroke", "black")
             .text("Pts Per Game");

            g.selectAll(".bar")
             .data(data)
             .enter().append("rect")
             .attr("class", "bar")
             .on("mouseover", onMouseOver)
             .on("mouseout", onMouseOut)
             .attr("x", function(d){
                return xScale(d.GAME_DATE);
             })
             .attr("y", function(d){
                return yScale(d.PTS);
             })
             .attr("width", xScale.bandwidth())
             .transition()
             .ease(d3.easeLinear)
             .duration(500)
             .delay(function(d, i) {
                return i * 50
             })
             .attr("height", function(d) {
                return height - yScale(d.PTS)
             });

            function onMouseOver(d, i) {
                var xPos = parseFloat(d3.select(this).attr('x')) + xScale.bandwidth() / 2;
		        var yPos = parseFloat(d3.select(this).attr('y')) / 2 + height / 2

                d3.select("#tooltip")
                  .style("left", xPos + "px")
                  .style("top", yPos + "px")
                  .select("#value")
                  .text("Pts Scored: " + i.PTS )
                  .append("p")
                  .append("text")
                  .text("MatchUp: " + i.MATCHUP)
                  .append("p")
                  .append("text")
                  .text("Mins Played: " + i.MIN)
                  .append("p")
                  .append("text")
                  .text("Assists: " + i.AST)
                  .append("p")
                  .append("text")
                  .text("Rebounds: " + i.REB)

                d3.select("#tooltip")
                  .classed("hidden", false)


                d3.select(this).attr("class", "highlight")
                d3.select(this).transition()
                               .duration(500)
                               .attr("width", xScale.bandwidth() + 5)
                               .attr("y", function(d) {
                                return yScale(d.PTS) - 10;
                               })
                               .attr("height", function(d) {
                                return height - yScale(d.PTS) + 10;
                               });
             };

            function onMouseOut(d, i) {
                d3.select(this).attr("class", "bar")
                d3.select(this).transition()
                               .duration(500)
                               .attr("width", xScale.bandwidth())
                               .attr("y", function(d) {
                                return yScale(d.PTS);
                               })
                               .attr("height", function(d) {
                                return height - yScale(d.PTS);
                               });
                
                d3.select("#tooltip")
                  .classed("hidden", true)
             };


    });
    </script>
    
   
{% endblock %}